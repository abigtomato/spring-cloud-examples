# sentinel流控规则
* 阈值类型
    * QPS：每秒钟的请求数量
    * 线程数
* 流控模式
    * 直接：API达到某一阈值时，直接限制调用
    * 关联：指定关联的资源，若对方达到某一阈值，对自己进行限制
    * 链路：只记录指定链路上的流量（指定资源从入口资源进来的流量，若达到阈值则限流）
* 流控效果
    * 快速失败：直接失败，抛出异常
    * 预热：根据codeFactor（冷加载因子，默认3）的值，计算出预热的时间窗口（阈值/codeFactor），当预热时间窗口结束，则进入设定的阈值时间窗口
    * 排队等待：排队处理请求，让请求匀速通过，阈值的类型必须设置为QPS

# sentinel降级规则
* sentinel熔断机制会在调用链路中某个资源出现不稳定状态时，对该资源的调用进行降级，让请求快速失败，避免影响其它资源导致级联错误
* 当资源被降级后，在接下来的时间窗口内，所有对该资源的调用都自动熔断
* sentinel的断路器和hystrix不同，不存在半开状态，只有当时间窗口结束，才会关闭断路器
* 降级策略
    * RT：当1s内持续进入5个请求，且对应时刻的平均响应时间（秒级）均超出阈值，两个条件同时满足后触发降级；时间窗口结束后，关闭断路器
    * 异常比例：当资源的QPS >= 5，且异常总数占通过量的比例（秒级统计）超过阈值（范围：[0.0, 1.0]）时触发降级；时间窗口结束后，关闭断路器
    * 异常数：当资源近1分钟的异常数量超过阈值则进行熔断（分钟级别，时间窗口的设置 >= 60s）；时间窗口结束后，关闭断路器

# sentinel热点规则
* 热点参数限流：统计传入参数中的热点参数，并根据配置的限流阈值（每秒访问的次数）与模式（仅QPS），对包含热点参数的资源调用进行限流
* 参数例外项：指定参数是某个特殊值时，限流的规则可以特殊处理（当a参数值为5时，QPS的阈值可以单独指定）

# sentinel + nacos持久化配置
* 配置内容
    * resource：资源名称
    * limitApp：来源应用
    * grade：阈值类型，0表示线程数，1表示QPS
    * count：单机阈值
    * strategy：流控模式，0表示直接，1表示关联，2表示链路
    * controlBehavior：流控效果，0表示快速失败，1表示预热，2表示排队等待
    * clusterMode：是否集群
```json
[
  {
    "resource": "",
    "limitApp": "default",
    "grade": 1,
    "count": 1,
    "strategy": 0,
    "controlBehavior": 0,
    "clusterMode": false
  }
]
```